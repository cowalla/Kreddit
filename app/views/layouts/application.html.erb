<!DOCTYPE html>
<html>


<head>
  <title>Kreddit</title>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>

	<script>
	$(document).ready(function(){
		$(".link-box").click(function(){
		   document.cookie = $(this).offset().top;
		});
	});
	console.log(document.cookie);
	$("html").scrollTop(document.cookie);
	
	</script>
	<script type="text/javascript" charset="utf-8">
	$(function () {
		that = $('.nav-sidebar');
		var targetDiv = $(".sidebar-favorites");
		that.on('click', 'li', function (event) {
			var action = $(event.currentTarget).data('action');
			RedditApp.router[action](targetDiv);
		});
	});
	</script>
	<script>
	$(document).ready(function(){
		
		$.ajax({
			url: "/user_links",
			success: function(data){
				data.forEach(function(userLinkData, index){
					$(".watch-button[data-link-id="+ userLinkData["link_id"] +"]")
					.addClass("unwatch-button btn btn-primary")
					.removeClass("watch-button")
					.text("Unwatch")
					.attr('data-ul-id', userLinkData["id"]);
					}
				)}
			});
			
		$("body").on("click", ".watch-button", function(event){
			var clickedButton = $(event.target);
			var userlinkLinkId = clickedButton.data("link-id");
			$.ajax({
				type: 'post',
				url: '/user_links',
				data: { link_id: userlinkLinkId, user_id: "1" },
				success: function(data){
					debugger
					console.log("posted");
				}
			});
		});
		
		$("body").on("click", ".unwatch-button", function(event){
			event.preventDefault();
			var clickedButton = $(event.target);
			var userlinkid = clickedButton.data("ul-id");
			$.ajax({
				type: 'delete',
				url: '/user_links/' + userlinkid,
				success: function(){
					console.log("deleted!");
					clickedButton.addClass("watch-button")
					.removeClass("unwatch-button")
					.text("Watch");
				}
			});
		});
		
	
	});
	</script>
	

</head>


<header>
	<div class="navbar-top-fixed">
		<font size="100"> Kreddit </font> 
	</div>
	<% @top_subreddits = Subreddit.all%>

		<ul class="nav nav-pills">
		<% @top_subreddits.each do |subreddit| %>
		<li>
		<a href="<%=subreddit_url(subreddit) %>"><%=subreddit.title%></a>
		</li>	
		<% end %>
		<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
	<li><div class="navbar">
		<% if !!current_user %>
		<div>
		    <b>Logged in as: <%=link_to current_user.username, user_url(current_user) %></b>
			<%= button_to "Logout", session_url, :method => :delete %>
		</div>
		<% end %>
		</div></li>
		</ul>	

</header>

<body>
	<div class="container">
		<div class="col-lg-9">
			<%= yield %>
		</div>

		<div class="col col-lg-2 sidebar-replace">
			<div class="list-group">
				<%= render "subreddits/sidebarContent" %>
			</div>
		</div>

		<div class="navbar navbar-default navbar-fixed-bottom">
			<div class="col col-lg-1">
				<div class="list-group">
					<%= render "sidebars/subreddit" %>
				</div>
			</div>
		</div>
		<div class="watched-posts">
		</div>
	</div>
</body>

</html>
